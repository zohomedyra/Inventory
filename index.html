<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Inventory + Batch + Committed Dashboard</title>

  <!-- Styles -->
  <style>
    :root{font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    *{box-sizing:border-box}
    body{margin:16px;color:#111;background:#fff}
    header{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    h1{margin:0;font-size:20px}
    h2{margin:0 0 8px}
    h3{margin:16px 0 8px}
    .muted{color:#6b7280;font-size:12px}
    .small{font-size:12px}
    .panel{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;margin:12px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .file{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;border-radius:8px;padding:8px 10px;background:#fff}
    select,input[type="search"],input[type="text"],input[type="number"]{padding:8px;border:1px solid #e5e7eb;border-radius:8px;background:#fff}
    .cards{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;min-width:180px;background:#fff;position:relative}
    .card .title{font-size:12px;color:#6b7280;margin-bottom:4px}
    .card .val{font-size:22px;font-weight:700}
    .card.wide{min-width:300px}
    .box{border:1px solid #e5e7eb;border-radius:8px;overflow:auto;max-height:60vh;background:#fff}
    table{border-collapse:collapse;width:100%}
    th,td{padding:8px 10px;border-bottom:1px solid #f0f0f0;white-space:nowrap}
    th{position:sticky;top:0;background:#fafafa;z-index:1}
    .dot{width:12px;height:12px;border-radius:50%;display:inline-block;margin-right:6px}
    .dotPulse{background:#ef4444;box-shadow:0 0 0 0 rgba(239,68,68,.7);animation:pulse 1.4s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(239,68,68,.7)}70%{box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}

    /* Colored left strip accents for cards */
    .card::before{
      content:"";
      position:absolute;
      left:0;
      top:10px;
      bottom:10px;
      width:6px;
      border-radius:6px;
      background:var(--accent,#e5e7eb);
    }
    .card.purple{ --accent:#7c3aed; }   /* SKUs */
    .card.blue{   --accent:#2563eb; }   /* SOH */
    .card.green{  --accent:#16a34a; }   /* Value */
    .card.orange{ --accent:#f59e0b; }   /* Mismatch */
    .card.teal{   --accent:#0d9488; }   /* Available */
    .card.rose{   --accent:#e11d48; }   /* Committed */
    .card.gray{   --accent:#6b7280; }   /* Product */
  </style>

  <!-- Libraries (defer) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js" defer></script>
  <!-- App JS (must be external, defer) -->
  <script src="app.js" defer></script>
</head>
<body>

<header class="row">
  <h1>ðŸ“¦ Inventory + ðŸ§ª Batch + ðŸ“‘ Committed</h1>
  <!-- IDs must match app.js: fileInv, fileBatch, fileCommitted -->
  <label class="file">Inventory Summary <input id="fileInv" type="file" accept=".xlsx,.xls,.csv"/></label>
  <label class="file">Batch Details <input id="fileBatch" type="file" accept=".xlsx,.xls,.csv"/></label>
  <label class="file">Committed Details <input id="fileCommitted" type="file" accept=".xlsx,.xls,.csv"/></label>
  <div id="status" class="muted"></div>
</header>

<!-- KPI Cards (IDs must match app.js kpis()) -->
<section class="panel">
  <div class="cards">
    <div class="card purple">
      <div class="title">Total SKUs (Inventory)</div>
      <div class="val" id="kpiSKUs">â€”</div>
    </div>
    <div class="card blue">
      <div class="title">Total Stock On Hand</div>
      <div class="val" id="kpiSOH">â€”</div>
    </div>
    <div class="card green">
      <div class="title">Inventory Value</div>
      <div class="val" id="kpiInvValue">â€”</div>
    </div>
    <div class="card orange">
      <div class="title">Mismatched SKUs</div>
      <div class="val" id="kpiMismatch">â€”</div>
    </div>
  </div>
</section>

<!-- Stock Check (IDs must match app.js: scCategory, scProduct, scProductSub, scCards, lk*) -->
<section class="panel">
  <h2>Stock Check</h2>
  <div class="row">
    <div>
      <div class="muted">Category</div>
      <select id="scCategory" style="min-width:220px"></select>
    </div>
    <div>
      <div class="muted">Product (Sales Description)</div>
      <select id="scProduct" style="min-width:360px"></select>
      <div id="scProductSub" class="muted small"></div>
    </div>
  </div>

  <div class="cards" id="scCards" style="display:none">
    <div class="card wide gray"><div class="title">Product</div><div class="val" id="lkProduct">â€”</div></div>
    <div class="card blue"><div class="title">Stock On Hand</div><div class="val" id="lkSOH">â€”</div></div>
    <div class="card rose"><div class="title">Committed Stock</div><div class="val" id="lkCommitted">â€”</div></div>
    <div class="card teal"><div class="title">Available for Sale</div><div class="val" id="lkAvail">â€”</div></div>
    <div class="card green"><div class="title">Stock Value (SOH Ã— Price)</div><div class="val" id="lkValue">â€”</div></div>
  </div>

  <!-- These IDs must match app.js: lookupCommitted, lookupBatches -->
  <div id="lookupCommitted" style="margin-top:10px"></div>
  <div id="lookupBatches" style="margin-top:10px"></div>
</section>

<!-- Top products (must be id="topProducts") -->
<section class="panel">
  <h2>Top products by Stock Value</h2>
  <div id="topProducts" style="height:380px"></div>
</section>

<!-- Mismatch table (must be id="mismatchTable") -->
<section class="panel">
  <h2>Mismatched SKU details (|Batch âˆ’ Inventory| &gt; 1)</h2>
  <div id="mismatchTable" class="box"></div>
</section>

<!-- Expiry analysis (must be id="expiryTable") -->
<section class="panel">
  <h2>Expiry analysis (expires in &lt; 11 months)</h2>
  <div id="expiryTable" class="box"></div>
</section>

<!-- Raw details (must be id="detailCat" and id="table") -->
<section class="panel">
  <h2>Details (first 2000 Inventory rows)</h2>
  <div class="row" style="margin-bottom:6px">
    <div class="muted">Filter by Category</div>
    <select id="detailCat" style="min-width:220px"></select>
  </div>
  <div id="table" class="box"></div>
</section>

<footer class="muted small">All processing happens in your browser. Files are not uploaded.</footer>
</body>
</html>
